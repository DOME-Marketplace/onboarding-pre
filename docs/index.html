
<!DOCTYPE html>
<html lang="en">

<head>
    <title>Onboarding</title>
    <link rel="stylesheet" href="assets/w3.css" />
    <link rel="stylesheet" href="assets/dome.css" />
    <link
        href="https://fonts.googleapis.com/css2?family=Blinker:wght@100;200;300;400;600;700;800;900&family=Caladea:ital,wght@0,400;0,700;1,400;1,700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200&icon_names=check_circle,counter_1,counter_2,counter_3" />

    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

    <script>
        const weAreOnGHProd = window.location.hostname.includes('onboarding.dome-marketplace.eu');
        const calledByDOMEProd = document.referrer.includes('dome-marketplace.eu');
        var needsRedirect = weAreOnGHProd && !calledByDOMEProd;
        if (needsRedirect) {
            window.location.href = 'https://dome-marketplace.github.io/onboarding-pre/';
        }
    </script>
</head>

<body>
    <header>
        
<div class="dome-header">
    <div class="dome-content">
        <div class="w3-bar">
            <div class="w3-bar-item padding-right-0">
                <a href="#">
                    <img src="assets/logos/DOME_Icon_White.svg" alt="DOME Icon" style="width:100%;max-height:32px">
                </a>
            </div>
            <div class="w3-bar-item">
                <span class="blinker-semibold w3-xlarge nowrap">DOME Marketplace</span>
            </div>
        </div>
    </div>
</div>

    </header>

    <main>
        <div style="background-color: #EDF2FA; min-height: 100vh;">
            <div class="w3-padding-32 dome-content">
                
<section class="onboarding-form" x-data="onboarding()" x-cloak>

    <h2 class="form-title" x-text="titles[step]"></h2>

    
    <div x-show="message" :class="messageType === 'error' ? 'w3-panel w3-red' : 'w3-panel w3-green'">
        <p x-text="message"></p>
    </div>

    
    <div x-show="step === 'email'">
        <p>Please enter your email to receive a verification code.</p>
        <form @submit.prevent="sendCode">
            <div class="w3-row">
                <div class="w3-third">
                    
<div class="form-group w3-margin-bottom">
    <label class="form-label">Email (*)</label>
    <input type="email" name="email" x-model="email" class="w3-input w3-border" required>
</div>

                </div>
            </div>
            <button type="submit" :disabled="loading"
                class="w3-btn dome-bgcolor w3-round-large w3-margin-right blinker-semibold">
                <span x-show="loading">Sending...</span>
                <span x-show="!loading">Send</span>
            </button>
        </form>
    </div>

    
    <div x-show="step === 'code'">
        <p>A code has been sent to <b x-text="email"></b>.</p>
        <div class="w3-panel w3-yellow">
            <p><strong>Note:</strong> For testing, we show here the code: <strong><span
                        x-text="codeValue"></span></strong></p>
        </div>

        <form @submit.prevent="verifyCode">
            <div class="w3-row">
                <div class="w3-third">
                    
<div class="form-group w3-margin-bottom">
    <label class="form-label">Verification Code (*)</label>
    <input type="text" name="code" x-model="code" class="w3-input w3-border" required>
</div>

                </div>
            </div>
            <button type="submit" :disabled="loading"
                class="w3-btn dome-bgcolor w3-round-large w3-margin-right blinker-semibold">
                <span x-show="loading">Verifying...</span>
                <span x-show="!loading">Verify Code</span>
            </button>
        </form>
    </div>

    
    <div x-show="step === 'register'">
        <form @submit.prevent="register">

            <div class="w3-row-padding" style="padding-left:0px">
                <div class="w3-third" style="padding-left:0px">
                    
                    <div class="form-group w3-margin-bottom">
                        <label class="form-label">Email</label>
                        <input type="email" class="w3-input w3-border" :value="email" disabled>
                    </div>

                </div>

                <div class="w3-third">
                    
<div class="form-group w3-margin-bottom">
    <label class="form-label">First Name (*)</label>
    <input type="text" name="firstName" x-model="formData.firstName" class="w3-input w3-border" required>
</div>

                </div>

                <div class="w3-third">
                    
<div class="form-group w3-margin-bottom">
    <label class="form-label">Last Name (*)</label>
    <input type="text" name="lastName" x-model="formData.lastName" class="w3-input w3-border" required>
</div>

                </div>

            </div>

            <div class="w3-row-padding" style="padding-left:0px">
                <div class="w3-third" style="padding-left:0px">
                    
<div class="form-group w3-margin-bottom">
    <label class="form-label">Company Name (*)</label>
    <input type="text" name="companyName" x-model="formData.companyName" class="w3-input w3-border" required>
</div>

                </div>
                <div class="w3-third">
                    
<div class="form-group w3-margin-bottom">
    <label class="form-label">Country of Incorporation (*)</label>
    <select name="country" x-model="formData.country" class="w3-select w3-border" required>
        <option value="" disabled selected>Select a country</option>
        
        <option value="US">United States</option>
        
        <option value="GB">United Kingdom</option>
        
        <option value="CA">Canada</option>
        
        <option value="AU">Australia</option>
        
        <option value="DE">Germany</option>
        
        <option value="FR">France</option>
        
        <option value="ES">Spain</option>
        
        <option value="IT">Italy</option>
        
        <option value="NL">Netherlands</option>
        
        <option value="BE">Belgium</option>
        
        <option value="CH">Switzerland</option>
        
        <option value="AT">Austria</option>
        
        <option value="SE">Sweden</option>
        
        <option value="NO">Norway</option>
        
        <option value="DK">Denmark</option>
        
        <option value="FI">Finland</option>
        
        <option value="IE">Ireland</option>
        
        <option value="PT">Portugal</option>
        
        <option value="GR">Greece</option>
        
        <option value="LU">Luxembourg</option>
        
        <option value="JP">Japan</option>
        
        <option value="CN">China</option>
        
        <option value="IN">India</option>
        
        <option value="BR">Brazil</option>
        
        <option value="MX">Mexico</option>
        
        <option value="ZA">South Africa</option>
        
        <option value="AE">United Arab Emirates</option>
        
        <option value="SG">Singapore</option>
        
        <option value="KR">South Korea</option>
        
        <option value="NZ">New Zealand</option>
        
    </select>
</div>

                </div>
                <div class="w3-third">
                    
<div class="form-group w3-margin-bottom">
    <label class="form-label">VAT ID (*)</label>
    <input type="text" name="vatId" x-model="formData.vatId" class="w3-input w3-border" required>
</div>

                </div>
            </div>

            
            <input type="text" name="website" x-model="formData.website" style="display:none" tabindex="-1"
                autocomplete="off">

            <p class=""><span class=""><b>Information about the processing of personal data is as follows:</b> <a
                        target="_blank" href="https://dome-project.eu/about/#partners">Data Controller DOME
                        Marketplace</a>.
                    Purpose: to send you information about DOME's project by electronic means. Legal basis: data
                    subject's consent.
                    Recipients: The personal data collected will not be communicated to third parties, unless requested
                    by public administrations or if required by law. Exercise of Rights: sending an email to <a
                        href="mailto:privacy.helpdesk@dome-project.eu">privacy.helpdesk@dome-project.eu</a>,
                    indicating in the subject line: 'Exercise of rights'. You are also entitled to be assisted by a Data
                    Protection Authority. Find more information about personal data processing in <a target="_blank"
                        href="https://dome-marketplace-sbx.org/assets/documents/privacy.pdf">our Privacy Policy
                        here</a>. </span></p>

            <button type="submit" :disabled="loading"
                class="w3-btn dome-bgcolor w3-round-large w3-margin-right blinker-semibold">
                <span x-show="loading">Registering...</span>
                <span x-show="!loading">Complete Registration</span>
            </button>
        </form>
    </div>

</section>

<script>
    function onboarding() {
        return {
            step: 'email',
            email: '',
            code: '',
            formData: {
                firstName: '',
                lastName: '',
                companyName: '',
                country: '',
                vatId: '',
                website: '' 
            },
            loading: false,
            message: '',
            messageType: '',
            codeValue: '',
            titles: {
                'email': 'Register in DOME Marketplace',
                'code': 'Verify Your Email',
                'register': 'Please fill this form to register'
            },

            async callApi(endpoint, body) {
                this.loading = true;
                this.message = '';
                try {
                    const res = await fetch(this.API_url() + endpoint, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-Requested-With': 'XMLHttpRequest' 
                        },
                        body: JSON.stringify(body)
                    });
                    const data = await res.json();
                    if (!data.success) {
                        throw new Error(data.message || 'Unknown error');
                    }
                    return data;
                } catch (err) {
                    this.message = err.message;
                    this.messageType = 'error';
                    return null;
                } finally {
                    this.loading = false;
                }
            },

            async sendCode() {
                const data = await this.callApi('/api/validate-email', { email: this.email });
                if (data) {
                    
                    this.codeValue = data.data.code;
                    this.step = 'code';
                }
            },

            async verifyCode() {
                const data = await this.callApi('/api/verify-code', { email: this.email, code: this.code });
                if (data) {
                    this.step = 'register';
                    this.message = '';
                }
            },

            async register() {
                
                const body = { ...this.formData, email: this.email };
                const data = await this.callApi('/api/register', body);
                if (data) {
                    this.message = 'Registration successful! Your registration is being processed.';
                    this.messageType = 'success';
                    
                }
            },

            frontURLs: {
                pro: 'dome-marketplace.github.io/onboarding',
                pre: 'dome-marketplace.github.io/onboarding-pre'
            },

            API_url() {
                if (window.location.hostname.includes(this.frontURLs.pro)) {
                    return 'https://onboarddome.evidenceledger.eu';
                }
                if (window.location.hostname.includes(this.frontURLs.pre)) {
                    return 'https://onboarddev.dome.mycredential.eu';
                }
                return 'https://onboarddev.dome.mycredential.eu';
            }
        }
    }
</script>

            </div>
        </div>
    </main>

    <footer>
        <div class="dome-content">
            
        </div>
    </footer>

</body>

</html>
